var message1 = errors.length > 0
  ? errors.join("\n")
  : "All datatypes and constraints are valid";

if (message1 === "All datatypes and constraints are valid") {

  // ✅ ALWAYS new ID per upload
  const dummyId = cds.utils.uuid();

  // ✅ CLEAN old state (CRITICAL)
  await tx.run(DELETE.from("COM_SCB_FILEUPLOAD_MASTER_DUMMY"));
  await tx.run(DELETE.from("COM_SCB_FILEUPLOAD_MASTER_DUPLICATEVALIDATIONRESULT"));

  // ✅ Insert current file JSON
  await tx.run(
    INSERT.into("COM_SCB_FILEUPLOAD_MASTER_DUMMY").entries({
      ID: dummyId,
      JSON_DATA: JSON.stringify(jsonData)
    })
  );

  // ✅ Call procedure (procedure writes into RESULT table)
  await tx.run(
    `CALL "GENERIC_DATA_VALIDATOR"(?, ?, ?, ?)`,
    [
      dummyId,
      MODULE_NAME,
      SUB_MODULE_NAME,
      LOAD_TEMPLATE
    ]
  );

  // ✅ Read validation result (SELECT.one → OBJECT)
  const result = await tx.run(
    SELECT.one
      .from("COM_SCB_FILEUPLOAD_MASTER_DUPLICATEVALIDATIONRESULT")
      .where({ ID: dummyId })
  );

  // ✅ Cleanup dummy data after validation
  await tx.run(
    DELETE.from("COM_SCB_FILEUPLOAD_MASTER_DUMMY")
      .where({ ID: dummyId })
  );

  // ✅ Safety check
  if (!result) {
    throw new Error("Duplicate validation result not found");
  }

  const status = result.STATUS;
  const message = result.MESSAGE;

  if (status === "E") {
    return {
      flag: false,
      message: message
    };
  }

  return {
    flag: true,
    message: "Proceed"
  };

} else {
  return {
    flag: false,
    message: message1
  };
}
