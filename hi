srv.on('UpdateStatusTemplate', async (req) => {

    const { id, action } = req.data;

    const db = await cds.connect.to('db');

    if (action === "approved") {

      const rows = await db.run(
        `SELECT MODULE_NAME,SUB_MODULE_NAME,LOAD_TEMPLATE,EXPIRY_DATE,JSON_TEMPLATE FROM com_scb_fileupload_master_TemplateStorage WHERE ID = ?`,
        [id]
      );
      if (!rows.length) {
        console.log('No row found for ID:', ID);
        return { data: [] };
      }

      const inputJson = JSON.parse(rows[0].JSON_TEMPLATE);

      var modulename = rows[0].MODULE_NAME;
      var submodulename = rows[0].SUB_MODULE_NAME;
      var templatename = rows[0].LOAD_TEMPLATE;

      var expirydate = rows[0].EXPIRY_DATE;

      //get container name from ModuleContainerMap table

      const containerName = await db.run(
        SELECT
          .from('com.scb.fileupload.master.ModuleContainerMap')
          .columns('CONTAINER_NAME')
          .where({ MODULE_NAME: modulename })
      );

      const { CONTAINER_NAME } = containerName[0];

      const loadTableMock = [
        {
          ID: cds.utils.uuid(),
          MODULE_NAME: modulename,
          SUB_MODULE_NAME: submodulename,
          LOAD_TEMPLATE: templatename,
          NUMBER_OF_COLUMNS: 0,
          EXPIRY_DATE: expirydate,
          DESTINATION_CONTAINER: CONTAINER_NAME,
          STG_TABLE: templatename
        }
      ];

      const loadMapMock = inputJson.map((col, index) => ({
        ID: cds.utils.uuid(),
        MODULE_NAME: modulename,
        SUB_MODULE_NAME: submodulename,
        LOAD_TEMPLATE: templatename,
        LOAD_COLUMN_SEQ: index + 1,
        COLUMN_NAME: col.COLUMN_NAME,
        COLUMN_DATATYPE: col.DATA_TYPE.startsWith("DECIMAL") ? "DECIMAL" : col.DATA_TYPE,
        CONSTRAINTS: col.CONSTRAINTS ? col.CONSTRAINTS.trim().toUpperCase() : null,
        IS_UNIQUE: 
      }));

      await db.run(INSERT.into('com.scb.fileupload.master.LoadTable').entries(loadTableMock));
      await db.run(INSERT.into('com.scb.fileupload.master.LoadMap').entries(loadMapMock));

    }

    const updateUser = await UPDATE('com.scb.fileupload.master.TemplateStorage')
      .set({
        STATUS: action
      })
      .where({ ID: id });

    const result = await UPDATE('com.scb.fileupload.master.TemplateStorage')
      .set({ ACTION_BY: req.user.id })
      .where({ ID: id });

    //
    return action;



  });
